# Liferay Registration Service

This module extends Liferay's Object functionality by integrating custom business logic for PDF parsing and user creation via workflow. It contains two key components:

---

## 🧩 1. `RegistrationObjectServiceWrapper`

**Purpose**: Intercepts object form submissions to read uploaded PDF files, extract a document ID from the text, and attach it to the ObjectEntry before saving.

### 🔍 Functionality Overview:

- Overrides `addObjectEntry()` from `ObjectEntryLocalServiceWrapper`.
- Reads the uploaded file from the `upload` field.
- Uses Apache PDFBox to extract text from the uploaded PDF.
- Extracts a "Document ID" using a regex pattern (`Document ID: ABC123...`).
- Adds `documentID` and `status=0` to the entry before saving (Draft/Pending).
- Adds detailed logging for traceability and debugging.

### 🔗 Integration Points:

- Injects `DLAppLocalService` to access uploaded file streams.
- Injected and wrapped via OSGi as a `ServiceWrapper`.

---

## ⚙️ 2. `RegistrationWorkflowHandler`

**Purpose**: Reacts to workflow status changes (especially approval), and programmatically creates a Liferay User based on object entry data.

### 🔍 Functionality Overview:

- Implements Liferay's `WorkflowHandler<ObjectEntry>`.
- Listens to status changes via `updateStatus()` override.
- When entry is approved:
  - Reads `name` and `email` fields from the entry.
  - Checks if user already exists.
  - If not, creates a new user with default config (autogenerated password, screen name).
- Logs whether a user is created or already exists.

### 🔗 Integration Points:

- Registered for `ObjectEntry` workflow model.
- Injects `ObjectEntryLocalService` and `UserLocalService`.

---

## 🏗️ Build & Deployment

### 📦 Build

Run the following from the root of the module:

```bash
./gradlew clean build
```

### 🚀 Deploy

Once built, copy the resulting JAR (`build/libs/com.yourcompany.registration-1.0.0.jar`) to your Liferay deploy folder:

```bash
cp build/libs/com.yourcompany.registration-1.0.0.jar $LIFERAY_HOME/osgi/modules/
```

Watch the logs for `[STARTED]` to confirm successful activation.

---

## 📋 Object Definition Requirements

Ensure your Liferay custom object includes the following fields:

| Field Name   | Type       | Notes                                  |
|--------------|------------|----------------------------------------|
| `upload`     | Attachment | Used to upload the PDF document        |
| `documentID` | Text       | Will be auto-filled by backend wrapper |
| `email`      | Text       | Used to create user                    |
| `name`       | Text       | Used as the user’s full name           |
| `status`     | Integer    | System field for workflow state        |

---

## ✅ Workflow Setup

- Add a Liferay Workflow to the object.
- Assign `RegistrationWorkflowHandler` to handle the workflow logic.
- Ensure the handler is registered for `com.liferay.object.model.ObjectEntry`.

---

## 🧠 Notes

- The regex for extracting `Document ID` is case-insensitive and allows for variations like `Document-ID: ABC123`.
- Designed to be fault-tolerant: if upload or PDF parsing fails, it logs a warning and still saves the object entry without `documentID`.

---

## 📞 Support

For any issues or deployment help, reach out to the project owner or refer to Liferay documentation on:

- [Service Wrappers](https://learn.liferay.com)
- [Workflow Handlers](https://learn.liferay.com)
- [Object Definitions](https://learn.liferay.com)